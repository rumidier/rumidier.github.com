
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Meadows of wild horses</title>
  <meta name="author" content="rumidier">

  
  <meta name="description" content="user의 아이디를 가지고 elapsed_at 의 내용을 가져 오게 된다
이 값은 2012-09-09 21:00:00 형식으로 되어 있으며
2012 와 09 를 기준으로 값을 따로 가지게 하여년도별 월 횟수를나타나게
해주었다 하지만 필요 없어 지움&#8230; &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://rumidier.github.com/blog/page/2/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Meadows of wild horses" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Meadows of wild horses</a></h1>
  
    <h2>Blog...</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:rumidier.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/09/18/month-split/">Month-split</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-09-18T15:30:00+09:00" pubdate data-updated="true">Sep 18<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/09/18/month-split/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>user의 아이디를 가지고 elapsed_at 의 내용을 가져 오게 된다
이 값은 2012-09-09 21:00:00 형식으로 되어 있으며
2012 와 09 를 기준으로 값을 따로 가지게 하여년도별 월 횟수를나타나게
해주었다 하지만 필요 없어 지움&#8230;</p>

<p>controll</p>

<pre><code>$cond = {} if %$cond;

my $user_id;
if ($id) {
    $user_id = $user_info-&gt;id;
}
else {
    $user_id = $c-&gt;user-&gt;id;
}

$cond-&gt;{'me.user_id'} = $user_id;

my %attr            = ( 'order_by' =&gt; { -desc =&gt; 'me.elapsed_at' } );

my $activity_search = $c-&gt;model('BikeMeDB')-&gt;resultset('Activity')-&gt;search($cond, \%attr);
my $activities      = [ $activity_search-&gt;all ];
my $activity_data   = {};

for my $activity (@{ $activities }) {
    my $year;
    my $month;

    my $elapsed = $activity-&gt;elapsed_at;
    $year       = $activity-&gt;elapsed_at-&gt;year;
    $month      = $activity-&gt;elapsed_at-&gt;month;

    my @split_elapsed = split('-', $activity-&gt;elapsed_at, 3);

    $activity_data-&gt;{$split_elapsed[0]}{$split_elapsed[1]}++;
}

my $year  = $c-&gt;req-&gt;params-&gt;{year};
my $month = $c-&gt;req-&gt;params-&gt;{month};

my $max_year  = '00000';
my $max_month = '00';

if ($year &amp;&amp; $month) {
    $max_year  = $year;
    $max_month = $month;
}
else {
    foreach my $year (keys %$activity_data) {
        if ($year gt $max_year) {
            $max_year = $year;
        }
        else {
            $max_month = '00';
            last;
        }

        foreach my $month (keys $activity_data-&gt;{$year}) {
            $max_month = $month if $month gt $max_month;
        }
    }
}

$cond = {} if %$cond;
$cond-&gt;{'me.user_id'} = $user_id;
$cond-&gt;{'me.elapsed_at'} = { 'like', "%"."$max_year"."-"."$max_month"."%" };

$activity_search = $c-&gt;model('BikeMeDB')-&gt;resultset('Activity')-&gt;search($cond, \%attr);
</code></pre>

<p>view - 년-월</p>

<pre><code>[% FOEACH year IN activity_data.keys.reverse %]
    [% FOREACH month IN activity_data.$year.keys.sort.reverse %]
  &lt;div class="btn"&gt;
    &lt;a href="[% c.uri_for('/activities') %]?year=[% year %]&amp;month=[% month %]" class="btn btn-primary"&gt;[% year %]-[% month %] ([% activity_data.$year.$month %])&lt;/a&gt;
&lt;/div&gt;
    [% END %]
[% END %]
</code></pre>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/09/11/catalyst-test-code/">Catalyst-test-code</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-09-11T18:46:00+09:00" pubdate data-updated="true">Sep 11<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/09/11/catalyst-test-code/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>Web - Catalyst Test Code 작성</h2>

<p>Catalyst로 웹을 구축 하던중 테스트 코드를 작성을 부여 받았습니다. 테스트 코드를 진행 하기 위한 모듈을 적습니다.</p>

<h2>모듈</h2>

<p><a href="https://metacpan.org/module/Test::More">Test::More</a></p>

<p>기본 적이 펄 테스트 코드 문법을 확인 할수 있습니다.</p>

<p><a href="https://metacpan.org/module/Catalyst::Test#res-request-...-">Catalyst::Test</a></p>

<p>content, response 페이지 정보를 얻어 올수 있습니다.</p>

<p><a href="ihttps://metacpan.org/module/HTTP::Response">HTTP::Response</a></p>

<p>response 정보등을 확인 할수 있습니다.</p>

<p><a href="https://metacpan.org/module/URI">URI</a></p>

<p>response 정보등을 확인 할수 있습니다.</p>

<p><a href="https://metacpan.org/module/HTTP::Request::Common">HTTP::Request::Common</a></p>

<p>Get POST 등을 구현 할수 있습니다.</p>

<p><a href="https://metacpan.org/module/CGI::Simple::Cookie">CGI::Simple::Cookie</a></p>

<p>로그인 인증 관련 세션 처리를 할수 있습니다.</p>

<p><a href="https://metacpan.org/module/HTTP::Cookies">HTTP::Cookies</a></p>

<p>CGI::Simple::Cookie로 쿠키 관련 재설정이 반복 되며 번거로울때
파일로 저장하여 사용할수 있다.</p>

<pre><code>## 첫번째 t 파일에서 login 하고 cookie 를 저장해둔다. pull/109설명중.
my $cookies = HTTP::Cookies-&gt;new(file =&gt; 't/.cookies');
# res &amp; res
$cookies-&gt;extract_cookies($res);
$cookies-&gt;save;

## 다른 t 파일에서는..
my $cookies = (split(/:/, HTTP::Cookies-&gt;new(file =&gt; 't/.cookies')-&gt;as_string))[1];
</code></pre>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/07/25/export-csv/">Export_csv</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-07-25T19:01:00+09:00" pubdate data-updated="true">Jul 25<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/07/25/export-csv/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>목차</p>

<ol>
<li>CSV 출력 준비</li>
<li>View 생성</li>
</ol>


<h3>CSV 출력 준비</h3>

<p>선택된 내역을 출력 하기 위한 버튼을 추가한다.</p>

<p>root/templates/bootstrap/src/deposit/index.tt</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>  &lt;a class="btn btn-primary" id="do_export"&gt;출력&lt;/a&gt;</span></code></pre></td></tr></table></div></figure>


<p>선택된 내역 js처리</p>

<p>root/static/scripts/list.js</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>  $('#do_export').click(function() {
</span><span class='line'>    var selected_charges = [];
</span><span class='line'>
</span><span class='line'>    $('#charge_list tr').filter(':has(:checkbox:checked)').each(function(){
</span><span class='line'>      if($(this).attr('id') !== undefined)
</span><span class='line'>        selected_charges.push($(this).attr('id'))
</span><span class='line'>    });
</span><span class='line'>
</span><span class='line'>    location.href = '/deposit/export/' + selected_charges;
</span><span class='line'>  });</span></code></pre></td></tr></table></div></figure>


<p>Sil/Web/Don/Controller/Deposit.pm</p>

<p>선택된 승인 내역을 CSV로 출력하기 위하여
모듈 - <a href="https://metacpan.org/module/Catalyst::View::Download::CSV">Catalyst::View::Download::CSV</a>을 사용 하였습니다.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sub export :Local CaptureArgs(1) {
</span><span class='line'>    my ( $self, $c, $id ) = @_;
</span><span class='line'>    my @target_ids = split ',', $id;
</span><span class='line'>    
</span><span class='line'>    my @charges;
</span><span class='line'>    
</span><span class='line'>    push @charges, ['제목', '청구자', '금액', '영수증날짜'];
</span><span class='line'>    
</span><span class='line'>    foreach my $charge($c-&gt;model('DonDB')-&gt;resultset('Charge')-&gt;search({id =&gt; { -in =&gt; \@target_ids }})-&gt;all) {
</span><span class='line'>        push @charges, [ $charge-&gt;title, $charge-&gt;user-&gt;user_name, $charge-&gt;amount, $charge-&gt;usage_date];
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    if (@charges) {
</span><span class='line'>        $c-&gt;stash-&gt;{'csv'} = { 'data' =&gt; [ @charges ] };
</span><span class='line'>        $c-&gt;flash-&gt;{messages} = 'Success Exported.';
</span><span class='line'>
</span><span class='line'>    } else {
</span><span class='line'>        $c-&gt;flash-&gt;{messages} = 'Export Failed.';
</span><span class='line'>    }
</span><span class='line'>    $c-&gt;forward('Sil::Web::Don::View::Download::CSV');
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h2>View 생성</h2>

<p>View는 script_web_don_create view로 생성한다.</p>

<p>list/Sil/Web/Don/View/Download/CSV.pm을 생성 완료.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>package Sil::Web::Don::View::Download::CSV;
</span><span class='line'>use Moose;
</span><span class='line'>use namespace::autoclean;
</span><span class='line'>
</span><span class='line'>extends 'Catalyst::View::Download::CSV';
</span><span class='line'>
</span><span class='line'>=head1 NAME
</span><span class='line'>
</span><span class='line'>Sil::Web::Don::View::Download::CSV - Catalyst View
</span><span class='line'>
</span><span class='line'>=head1 DESCRIPTION
</span><span class='line'>
</span><span class='line'>Catalyst View.
</span><span class='line'>
</span><span class='line'>=head1 AUTHOR
</span><span class='line'>
</span><span class='line'>ja3ck
</span><span class='line'>
</span><span class='line'>=head1 LICENSE
</span><span class='line'>
</span><span class='line'>This library is free software. You can redistribute it and/or modify
</span><span class='line'>it under the same terms as Perl itself.
</span><span class='line'>
</span><span class='line'>=cut
</span><span class='line'>
</span><span class='line'>__PACKAGE__-&gt;meta-&gt;make_immutable;
</span><span class='line'>
</span><span class='line'>1;</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/07/25/db-password-hash/">DB_Password_Hash</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-07-25T16:41:00+09:00" pubdate data-updated="true">Jul 25<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/07/25/db-password-hash/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>DB Password HASH</h2>

<p><a href="https://metacpan.org/module/DBIx::Class::EncodedColumn">DBIx::Class::EncodedColumn</a></p>

<p>기본 입력값 입력시 sha(&#8216;password&#8217;)사용 하여 암호화 할수 있도록 한다.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>INSERT INTO `user` VALUES (2,'rum_user','rum_user@mail.com',sha('Password'),localtime ,localtime);</span></code></pre></td></tr></table></div></figure>


<p>MyWeb::ResultBase.pm에 EncodedColumn 추가하여 준다.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>__PACKAGE__-&gt;load_components(qw/
</span><span class='line'>    EncodedColumn
</span><span class='line'>    InflateColumn::DateTime
</span><span class='line'>    TimeStamp
</span><span class='line'>/);</span></code></pre></td></tr></table></div></figure>


<p><a href="https://metacpan.org/module/Catalyst::Plugin::Authentication">Catalyst::Plugin::Authentication</a></p>

<p>my_web.conf 파일에 플러그인 설정 추가
pawword_type 설정시 디폴트로 SHA-1이 적용되지만
명시적으로 password_hash_type을 정의 하여 준다.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;Plugin::Authentication&gt;
</span><span class='line'>    &lt;default&gt;
</span><span class='line'>        password_type      hashed
</span><span class='line'>        password_hash_type SHA-1
</span><span class='line'>        user_model         DonDB::User
</span><span class='line'>        class              SimpleDB
</span><span class='line'>    &lt;/default&gt;
</span><span class='line'>&lt;/Plugin::Authentication&gt;</span></code></pre></td></tr></table></div></figure>


<h3>설정 추가 참고 자료</h3>

<p><a href="https://metacpan.org/module/Catalyst::Authentication::Credential::Password">Catalyst::Authentication::Credential::Password</a></p>

<p><a href="https://metacpan.org/module/Digest#new">Digest</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/07/24/templet-br/">Templet_br</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-07-24T14:28:00+09:00" pubdate data-updated="true">Jul 24<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/07/24/templet-br/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content">
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/07/24/don-change-space/">Don-Change-space</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-07-24T14:20:00+09:00" pubdate data-updated="true">Jul 24<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/07/24/don-change-space/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>Sil::Web::Don 변경</h2>

<p>Sil::Schema는 Sil의 공용 스키마가 아닌데도 불구 하고 그렇게 보일수도 있는
상태 이다 이를 바꾸기 위해서
Sil::Don::Schema로 바꾼다. 이는 Sil의 Don만의 스키마라고
명시 해주는것과 같다.</p>

<p>변경전</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>lib
</span><span class='line'>`-- Sil
</span><span class='line'>    |-- Schema
</span><span class='line'>    |   |-- Result
</span><span class='line'>    |   |   |-- Charge.pm
</span><span class='line'>    |   |   `-- User.pm
</span><span class='line'>    |   `-- ResultBase.pm
</span><span class='line'>    |-- Schema.pm
</span><span class='line'>    `-- Web
</span><span class='line'>        |-- Don
</span><span class='line'>        |   |-- Controller
</span><span class='line'>        |   |   |-- Deposit.pm
</span><span class='line'>        |   |   |-- List.pm
</span><span class='line'>        |   |   |-- Login.pm
</span><span class='line'>        |   |   |-- Logout.pm
</span><span class='line'>        |   |   `-- Root.pm
</span><span class='line'>        |   |-- Model
</span><span class='line'>        |   |   `-- DonDB.pm
</span><span class='line'>        |   `-- View
</span><span class='line'>        |       |-- Bootstrap.pm
</span><span class='line'>        |       `-- Download
</span><span class='line'>        |           `-- CSV.pm
</span><span class='line'>        `-- Don.pm</span></code></pre></td></tr></table></div></figure>


<p> 변경후</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> lib
</span><span class='line'>└── Sil
</span><span class='line'>    └── Don
</span><span class='line'>        ├── Schema
</span><span class='line'>        │   ├── Result
</span><span class='line'>        │   │   ├── Charge.pm
</span><span class='line'>        │   │   └── User.pm
</span><span class='line'>        │   └── ResultBase.pm
</span><span class='line'>        ├── Schema.pm
</span><span class='line'>        ├── Web
</span><span class='line'>        │   ├── Controller
</span><span class='line'>        │   │   ├── Deposit.pm
</span><span class='line'>        │   │   ├── List.pm
</span><span class='line'>        │   │   ├── Login.pm
</span><span class='line'>        │   │   ├── Logout.pm
</span><span class='line'>        │   │   └── Root.pm
</span><span class='line'>        │   ├── Model
</span><span class='line'>        │   │   └── DonDB.pm
</span><span class='line'>        │   └── View
</span><span class='line'>        │       ├── Bootstrap.pm
</span><span class='line'>        │       └── Download
</span><span class='line'>        │           └── CSV.pm
</span><span class='line'>        └── Web.pm</span></code></pre></td></tr></table></div></figure>


<h2>경로명 변경</h2>

<p>의존성이 걸려있는 모든 내역들을 grep 명령어로 찾아 아래와 같이 수정해 주었다.</p>

<p>변경전</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Sil::Schema::Result::Charge
</span><span class='line'>Sil::Schema::Result::User
</span><span class='line'>Sil::Schema::ResultBase
</span><span class='line'>Sil::Schema
</span><span class='line'>
</span><span class='line'>Sil::Web::Don::Controller::Deposit
</span><span class='line'>Sil::Web::Don::Controller::List
</span><span class='line'>Sil::Web::Don::Controller::Login
</span><span class='line'>Sil::Web::Don::Controller::Logout
</span><span class='line'>Sil::Web::Don::Controller::Root
</span><span class='line'>Sil::Web::Don::Model::DonDB
</span><span class='line'>Sil::Web::Don::View::Bootstrap
</span><span class='line'>Sil::Web::Don::View::Download::CS
</span><span class='line'>Sil::Web::Don</span></code></pre></td></tr></table></div></figure>


<p>변경후</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Sil::Don::Schema::Result::Charge
</span><span class='line'>Sil::Don::Schema::Result::User
</span><span class='line'>Sil::Don::Schema::ResultBase
</span><span class='line'>Sil::Don::Schema
</span><span class='line'>
</span><span class='line'>Sil::Don::Web::Controller::Deposit
</span><span class='line'>Sil::Don::Web::Controller::List
</span><span class='line'>Sil::Don::Web::Controller::Login
</span><span class='line'>Sil::Don::Web::Controller::Logout
</span><span class='line'>Sil::Don::Web::Controller::Root
</span><span class='line'>Sil::Don::Web::Model::DonDB
</span><span class='line'>Sil::Don::Web::View::Bootstrap
</span><span class='line'>Sil::Don::Web::View::Download::CS
</span><span class='line'>Sil::Don::Web</span></code></pre></td></tr></table></div></figure>


<h2>변경후 문제점</h2>

<p>내용 수정후 서버 실행이 app.psgi에서 모듈을 찾지 못한다고 하였다.
이유는 Sil_web_Don.conf 파일명을 수정 해주지 않았기에 발생한 문제였다.
경로명이 바뀌엇듯이 파일명도 교체 해주어야 한다.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/07/23/don-release/">Don Release</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-07-23T18:49:00+09:00" pubdate data-updated="true">Jul 23<span>rd</span>, 2012</time>
        
         | <a href="/blog/2012/07/23/don-release/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>Donnenwa Open</h2>

<ol>
<li>DNS 요구</li>
<li>Apache2 설정</li>
<li>supervisior 설정</li>
<li>확인</li>
</ol>


<h3>DNS 요구</h3>

<p>도메인 네임을 받아 현진이(서버)에 연결해 주어야 하지만
브롬튼에 도메인이 정의가 되있기 때문에 SE님에게 요구하면 된다.(나만되는겨)</p>

<h3>Apache2 설정</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ ssh rumidier@bu….접속
</span><span class='line'>$ cd /etc/apache2/
</span><span class='line'>$ cd sites-available
</span><span class='line'>$ vi user.site.kr (작성)
</span><span class='line'>$ cd ../
</span><span class='line'>$ cd sites-enable
</span><span class='line'>$ ln -s 타킷-경로
</span><span class='line'>$ ~/etc/init.d/apache2 restart</span></code></pre></td></tr></table></div></figure>


<p></p>

<h3>supervisior 설정</h3>

<p>슈퍼 바이저는 서버가 죽었다 다시 살아 났을시 수동이 아닌 자동으로 서버를 뛰워주기 위해 필요한 기능이다.</p>

<p>돈내놔는 carton을 사용하고 plackup으로 뛰우며 플라넥스와는 다르게 worker의 갯수가 존재 하지 않는다. 포트 설정은 아파치에서 해준 포트를 명시 해준후 디렉토리와 유저, 환경 등록을 해주면 끝이 난다.
환경경로는 carton과 plackup 경로도 알아야 하는거 같다(이 부분은 설명이 더 필요)</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ cd /etc
</span><span class='line'>$ vi supervisord.conf
</span><span class='line'>
</span><span class='line'>[program:Donnenwa] 
</span><span class='line'>command=/usr/local/bin/carton exec -Ilib -- /home/USER Donnenwa/local/bin/plackup -Ilib -a /home/USER/Donnenwa
</span><span class='line'>app.psgi --host 127.0.0.1 --port You_port(ex:3000)  
</span><span class='line'>directory=/home/User/Donnenwa 
</span><span class='line'>user=USER 
</span><span class='line'>environment=PATH=/usr/local/bin:/usr/bin:/bin,HOME=/home/USER
</span><span class='line'>stdout_logfile=/home/USER/logs/stdout 
</span><span class='line'>stderr_logfile=/home/USER/logs/stderr 
</span><span class='line'>
</span><span class='line'>$ sudo supervisorctl
</span><span class='line'>supervisor&gt; status
</span><span class='line'>….
</span><span class='line'>supervisor&gt; update
</span><span class='line'>supervisor&gt; exit
</span><span class='line'>$ 서버 실행 확인 끝</span></code></pre></td></tr></table></div></figure>


<h3>더 물어 봐야 할것</h3>

<ol>
<li>supervisor의 셋팅을 무엇을 참조 하는가?</li>
<li>도메인 등록은 어떻게 하는가?</li>
<li>apach2 설정은 어떻게 하는가?</li>
</ol>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/07/12/side-function/">Side-function</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-07-12T14:03:00+09:00" pubdate data-updated="true">Jul 12<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/07/12/side-function/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>Action - approval, refuse</h2>

<p><a href="https://gist.github.com/3096325">approval</a></p>

<p><a href="https://gist.github.com/3096321">refuse</a></p>

<p>Approval은 청구 목록에 대하여 승인 기능을
refuse는 청구 목렉에 대하여 거부 기능을 가지게 된다.</p>

<p>승인 기능은 두가지 상황에서 선택 할수 있게 된다.
/list/view/user_num과 전체 list상태, 대기 리스트 상태, 거부 리스트 상태
에서 활성화가 되고 action을 취할수 있게 한다.</p>

<p>거부 기능은 두가지 상황에서 선택 할수 있게 된다.
/list/view/user_num과 전체 list상태, 대기 리스트 상태, 승인 리스트 상태
에서 활성화가 되고 action 을 취할수 있게 한다.</p>

<p>/list/view/user_id</p>

<p>아래와 같이 id 값과 함께 전달 할수 있다.</p>

<pre><code>&lt;a href="[% c.uri_for('/list/approval', charge.id) %]" class="btn btn-primary"&gt;승인&lt;/a&gt;
&lt;a href="[% c.uri_for('/list/refuse', charge.id) %]" class="btn btn-primary"&gt;거부&lt;/a&gt;
</code></pre>

<p>CaputreArgs(1) 옵션으로 $id 값(들)을 받을수 있게 된다.</p>

<pre><code>sub approval :Local :CaptureArgs(1) {
    my ( $self, $c, $id ) = @_;
    my @target_ids = split ',', $id;

sub refuse :Local :CaptureArgs(1) {
my ( $self, $c, $id ) = @_;
my @target_ids = split ',', $id;
</code></pre>

<p>@target_id의 모든 값(들)을 status값이 2 or 3로 업데이트 한다.
업데이트는 검색을 한 값들을 대상으로 update를 하게 된다.</p>

<pre><code>$ vi root/templates/default/src/list

# 승인
my $approval = $c-&gt;model('MyApp_DB')-&gt;resultset('Charge')-&gt;search({ id =&gt; { -in
        =&gt; \@target_ids } })-&gt;update_all({ status =&gt; '2' });
# 거부
my $refuse = $c-&gt;model('MyApp_DB')-&gt;resultset('Charge')-&gt;search({ id =&gt; { -in
        =&gt; \@target_ids } })-&gt;update_all({ status =&gt; '3' });
</code></pre>

<p>flash기능으로 messages값을 전달하여 조건에 맞을시 메세지를 출력 시키도록 한다.(/list/index.tt 참고)
조건은 approval, refuse기능이 정상 작동 되었는지를 검사 하게 된다.</p>

<pre><code>if ($query_status) {
    $c-&gt;flash-&gt;{messages} = 'Success message.';
}
else {
    $c-&gt;flash-&gt;{messages} = 'No status Item.';
}
</code></pre>

<p>템플릿에 쓰일 status값과 함께 전체 목록으로 redirect 시키도록 한다.</p>

<pre><code>$c-&gt;stash-&gt;{status} = '2'; #상태에 맞는 status값
$c-&gt;res-&gt;redirect($c-&gt;uri_for('/list'));
</code></pre>

<h2>Action - delete</h2>

<p><a href="https://gist.github.com/3096329">delete</a></p>

<p>승인 기능은 두가지 상황에서 선택 할수 있게 된다.
/list/view/user_num과 전체 list상태, 대기, 거부, 수정 상태
 에서 활성화가 되고 action을 취할수 있게 한다.</p>

<pre><code>$ vi root/templates/default/src/list
&lt;a href="[% c.uri_for('/list/delete', charge.id) %]" class="btn btn-primary"&gt;삭제&lt;/a&gt;
</code></pre>

<p>다른 기능과 같이 CaptureArgs(1)를 받는다.</p>

<pre><code>sub delete :Local :CaptureArgs(1) {
my ( $self, $c, $id ) = @_;
my @target_ids = split ',', $id;
</code></pre>

<p>다른 기능과 달리 update_all 이 아닌 delete_all를 통하여 내용을 삭제 한다.</p>

<pre><code>my $charge = $c-&gt;model('DonDB')-&gt;resultset('Charge')-&gt;search({ id =&gt; { -in =&gt; \@target_ids } })-&gt;delete_all;
</code></pre>

<h2>CPAN</h2>

<p><a href="https://metacpan.org/module/DBIx::Class::Manual::DocMap">DBIx::Class::Manual::DocMap</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/07/12/list-edit/">List-edit</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-07-12T13:56:00+09:00" pubdate data-updated="true">Jul 12<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/07/12/list-edit/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>청구 내역 수정</h2>

<p><a href="https://gist.github.com/3095912">List-edit-action</a></p>

<p>수정 되어야할 $edit_id를 받을수 있어햐 한다.</p>

<pre><code>sub edit :Local :CaptureArgs(1) {
my ( $self, $c, $edit_id ) = @_;
</code></pre>

<p>수정할 폼을 제출 했을때 업데이트 동작 혹은 정보 출력을 하여야 한다.</p>

<pre><code>if ($c-&gt;req-&gt;method eq 'POST') {
    my @messages;

    push @messages, 'amount is invaild' if ($c-&gt;req-&gt;params-&gt;{amount} !~ /^\d+$/);
    push @messages, 'title is required' unless ($c-&gt;req-&gt;params-&gt;{title});

    if (@messages) {
    $c-&gt;flash(
        messages =&gt; @messages,
        comment  =&gt; $c-&gt;req-&gt;params-&gt;{comment},
        title    =&gt; $c-&gt;req-&gt;params-&gt;{title},
        amount   =&gt; $c-&gt;req-&gt;params-&gt;{amount},
    );

    return $c-&gt;res-&gt;redirect($c-&gt;uri_for("/list/view/$c-&gt;req-&gt;params-&gt;{charge_id}"));
    }

    my $time = strftime "%Y-%m-%d %H:%M:%S", localtime;
    my %row = (
    id         =&gt; $c-&gt;req-&gt;params-&gt;{charge_id},
    amount     =&gt; $c-&gt;req-&gt;params-&gt;{amount},
    user       =&gt; $c-&gt;req-&gt;params-&gt;{charge_user},
    title      =&gt; $c-&gt;req-&gt;params-&gt;{title},
    comment    =&gt; $c-&gt;req-&gt;params-&gt;{comment},
    updated_on =&gt; "$time",
    );
    $c-&gt;model('DonDB')-&gt;resultset('Charge')-&gt;update_or_create(\%row);

    $c-&gt;res-&gt;redirect($c-&gt;uri_for("/list/view/$row{id}"));
}
else {
    my $editer = $c-&gt;model('DonDB')-&gt;resultset('Charge')-&gt;find($edit_id);

    $c-&gt;stash(
    editer =&gt; $editer,
    );
}
}
</code></pre>

<p><a href="https://gist.github.com/3095922">List-edit.tt</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/07/12/list-write/">List-write</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-07-12T13:49:00+09:00" pubdate data-updated="true">Jul 12<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/07/12/list-write/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="https://gist.github.com/3095879">List-write.tt</a>
<a href="https://gist.github.com/3095901">List-write-action</a></p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/3/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2012/11/27/perl/">Perl</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/11/26/sass/">Sass</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/11/26/phonegap-android/">Phonegap-Android</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/rumidier">@rumidier</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'rumidier',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("rumidier", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/rumidier" class="twitter-follow-button" data-show-count="false">Follow @rumidier</a>
  
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - rumidier -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'rumidier';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
